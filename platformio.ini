; ============================================================================
; Common ESP32 configuration
; ============================================================================
[esp32_common]
platform = espressif32
board = esp32doit-devkit-v1
framework = arduino

; Library dependencies - versions pinned where available
lib_deps = 
    robtillaart/RunningAverage @ 0.4.8
    me-no-dev/ESPAsyncWebServer
    me-no-dev/AsyncTCP
    alanswx/ESPAsyncWiFiManager @ 0.31
    fastled/FastLED @ 3.10.3
    ropg/ezTime @ 0.8.3
    claws/BH1750 @ 1.3.0
    adafruit/Adafruit BusIO @ 1.17.4
    adafruit/Adafruit INA219 @ 1.2.3
    igorantolic/Ai Esp32 Rotary Encoder @ 1.7.0
    jnthas/Improv WiFi Library @ 0.0.4

; Local library override (comment out and uncomment GitHub line for release)
lib_extra_dirs = tmp
; lib_deps += https://github.com/soliddifference/siebenuhr_core.git#v1.1.0

; Serial monitor
monitor_speed = 115200
upload_speed = 460800
monitor_filters = direct

; Create merged firmware binary for web flasher tools (flashes to 0x0)
extra_scripts = post:scripts/merge_firmware.py

; ============================================================================
; ESP32 - Mini Clock (4 LEDs per segment, 112 total)
; Build: pio run -e esp32-mini
; ============================================================================
[env:esp32-mini]
extends = esp32_common
build_flags = 
    -D BUILD_CLOCK_MINI=1
    -D SENSOR_READ_INTERVAL_MS=10000
    ; -D AUTO_BRIGHTNESS_ENABLED=1
    -D POWER_MONITORING_ENABLED=1
    -D VERBOSE_LOGGING=1

; ============================================================================
; ESP32 - Regular Clock (17 LEDs per segment, 476 total)
; Build: pio run -e esp32-regular
; ============================================================================
[env:esp32-regular]
extends = esp32_common
build_flags = 
    -D BUILD_CLOCK_REGULAR=1
    -D SENSOR_READ_INTERVAL_MS=10000
    ; -D AUTO_BRIGHTNESS_ENABLED=1
    -D POWER_MONITORING_ENABLED=1
    -D VERBOSE_LOGGING=1

; ============================================================================
; Native test environment (runs on host, not ESP32)
; Run tests with: pio test -e native
; ============================================================================
[env:native]
platform = native
test_framework = unity
build_flags = 
    -std=c++17
    -DUNIT_TEST
    -I test/mocks
    -I src
build_src_filter =
    +<../test/mocks/>
    +<configuration.cpp>
lib_deps =
lib_ignore = 
    FastLED
    ESPAsyncWebServer
    AsyncTCP
    ESPAsyncWiFiManager
    ezTime
    BH1750
    Adafruit BusIO
    Adafruit INA219
    Ai Esp32 Rotary Encoder
    RunningAverage
    siebenuhr_core
    Improv WiFi Library
